{"ast":null,"code":"import { CommonModule } from \"@angular/common\";\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@angular/common/http\";\nimport * as i2 from \"@angular/common\";\nfunction AppComponent_div_31_div_2_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 18);\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const colIndex_r1 = ctx.index;\n    const rowIndex_r2 = i0.ɵɵnextContext().index;\n    const ctx_r2 = i0.ɵɵnextContext();\n    i0.ɵɵadvance();\n    i0.ɵɵtextInterpolate1(\" \", ctx_r2.board[rowIndex_r2][colIndex_r1], \" \");\n  }\n}\nfunction AppComponent_div_31_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 15)(1, \"div\", 16);\n    i0.ɵɵtemplate(2, AppComponent_div_31_div_2_Template, 2, 1, \"div\", 17);\n    i0.ɵɵelementEnd()();\n  }\n  if (rf & 2) {\n    const row_r4 = ctx.$implicit;\n    i0.ɵɵadvance(2);\n    i0.ɵɵproperty(\"ngForOf\", row_r4);\n  }\n}\nfunction AppComponent_li_37_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"li\");\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const move_r5 = ctx.$implicit;\n    const i_r6 = ctx.index;\n    i0.ɵɵadvance();\n    i0.ɵɵtextInterpolate4(\" #\", i_r6 + 1, \" - Player \", move_r5.player, \" \\u2192 (\", move_r5.row, \", \", move_r5.column, \") \");\n  }\n}\nfunction AppComponent_li_38_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"li\");\n    i0.ɵɵtext(1, \"No moves yet.\");\n    i0.ɵɵelementEnd();\n  }\n}\nfunction AppComponent_div_44_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 19);\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const ctx_r2 = i0.ɵɵnextContext();\n    i0.ɵɵadvance();\n    i0.ɵɵtextInterpolate1(\" \", ctx_r2.errorMessage, \" \");\n  }\n}\nexport let AppComponent = /*#__PURE__*/(() => {\n  class AppComponent {\n    http;\n    engineBaseUrl = \"http://localhost:8080\";\n    sessionBaseUrl = \"http://localhost:8081\";\n    sessionId = \"\";\n    gameId = \"\";\n    gameStatus = \"\";\n    sessionStatus = \"\";\n    board = this.createEmptyBoard();\n    moves = [];\n    lastMessage = \"\";\n    errorMessage = \"\";\n    isSimulating = false;\n    eventSource;\n    constructor(http) {\n      this.http = http;\n    }\n    ngOnDestroy() {\n      this.closeStream();\n    }\n    startSimulation() {\n      this.resetState();\n      this.http.post(`${this.sessionBaseUrl}/sessions`, {}).subscribe({\n        next: session => {\n          this.sessionId = session.sessionId;\n          this.gameId = session.gameId;\n          this.applySession(session);\n          this.openStream();\n          this.triggerSimulation();\n        },\n        error: err => {\n          this.errorMessage = this.extractError(err);\n        }\n      });\n    }\n    triggerSimulation() {\n      if (!this.sessionId) {\n        return;\n      }\n      this.isSimulating = true;\n      this.http.post(`${this.sessionBaseUrl}/sessions/${this.sessionId}/simulate`, {}).subscribe({\n        next: session => {\n          this.applySession(session);\n          this.isSimulating = false;\n        },\n        error: err => {\n          this.errorMessage = this.extractError(err);\n          this.isSimulating = false;\n        }\n      });\n    }\n    openStream() {\n      if (!this.gameId) {\n        return;\n      }\n      this.closeStream();\n      this.eventSource = new EventSource(`${this.engineBaseUrl}/games/${this.gameId}/stream`);\n      this.eventSource.onmessage = event => {\n        const data = JSON.parse(event.data);\n        this.gameStatus = data.status;\n        this.board = data.board ?? this.board;\n        this.lastMessage = data.message ?? \"\";\n        this.refreshSession();\n      };\n      this.eventSource.onerror = () => {\n        this.errorMessage = \"Live updates disconnected. Please refresh or retry.\";\n        this.closeStream();\n      };\n    }\n    refreshSession() {\n      if (!this.sessionId) {\n        return;\n      }\n      this.http.get(`${this.sessionBaseUrl}/sessions/${this.sessionId}`).subscribe({\n        next: session => this.applySession(session),\n        error: () => {}\n      });\n    }\n    applySession(session) {\n      this.sessionStatus = session.status;\n      this.gameStatus = session.gameStatus || this.gameStatus;\n      this.board = session.board ?? this.board;\n      this.moves = session.moves ?? [];\n      if (session.error) {\n        this.errorMessage = session.error.message;\n      }\n    }\n    resetState() {\n      this.sessionId = \"\";\n      this.gameId = \"\";\n      this.gameStatus = \"\";\n      this.sessionStatus = \"\";\n      this.board = this.createEmptyBoard();\n      this.moves = [];\n      this.lastMessage = \"\";\n      this.errorMessage = \"\";\n      this.isSimulating = false;\n      this.closeStream();\n    }\n    closeStream() {\n      if (this.eventSource) {\n        this.eventSource.close();\n        this.eventSource = undefined;\n      }\n    }\n    createEmptyBoard() {\n      return Array.from({\n        length: 3\n      }, () => Array.from({\n        length: 3\n      }, () => \" \"));\n    }\n    extractError(err) {\n      return err?.error?.message || err?.message || \"Unexpected error occurred\";\n    }\n    static ɵfac = function AppComponent_Factory(t) {\n      return new (t || AppComponent)(i0.ɵɵdirectiveInject(i1.HttpClient));\n    };\n    static ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n      type: AppComponent,\n      selectors: [[\"app-root\"]],\n      standalone: true,\n      features: [i0.ɵɵStandaloneFeature],\n      decls: 45,\n      vars: 11,\n      consts: [[1, \"page\"], [1, \"header\"], [1, \"primary\", 3, \"click\", \"disabled\"], [1, \"status\"], [1, \"status-item\"], [1, \"label\"], [1, \"value\"], [1, \"value\", \"mono\"], [1, \"board\"], [\"class\", \"cell\", 4, \"ngFor\", \"ngForOf\"], [1, \"info\"], [1, \"panel\"], [4, \"ngFor\", \"ngForOf\"], [4, \"ngIf\"], [\"class\", \"error\", 4, \"ngIf\"], [1, \"cell\"], [1, \"cell-row\"], [\"class\", \"cell-item\", 4, \"ngFor\", \"ngForOf\"], [1, \"cell-item\"], [1, \"error\"]],\n      template: function AppComponent_Template(rf, ctx) {\n        if (rf & 1) {\n          i0.ɵɵelementStart(0, \"main\", 0)(1, \"header\", 1)(2, \"div\")(3, \"h1\");\n          i0.ɵɵtext(4, \"Tic Tac Toe\");\n          i0.ɵɵelementEnd();\n          i0.ɵɵelementStart(5, \"p\");\n          i0.ɵɵtext(6, \"Automated simulation via microservices\");\n          i0.ɵɵelementEnd()();\n          i0.ɵɵelementStart(7, \"button\", 2);\n          i0.ɵɵlistener(\"click\", function AppComponent_Template_button_click_7_listener() {\n            return ctx.startSimulation();\n          });\n          i0.ɵɵtext(8);\n          i0.ɵɵelementEnd()();\n          i0.ɵɵelementStart(9, \"section\", 3)(10, \"div\", 4)(11, \"span\", 5);\n          i0.ɵɵtext(12, \"Session\");\n          i0.ɵɵelementEnd();\n          i0.ɵɵelementStart(13, \"span\", 6);\n          i0.ɵɵtext(14);\n          i0.ɵɵelementEnd()();\n          i0.ɵɵelementStart(15, \"div\", 4)(16, \"span\", 5);\n          i0.ɵɵtext(17, \"Game\");\n          i0.ɵɵelementEnd();\n          i0.ɵɵelementStart(18, \"span\", 6);\n          i0.ɵɵtext(19);\n          i0.ɵɵelementEnd()();\n          i0.ɵɵelementStart(20, \"div\", 4)(21, \"span\", 5);\n          i0.ɵɵtext(22, \"Session ID\");\n          i0.ɵɵelementEnd();\n          i0.ɵɵelementStart(23, \"span\", 7);\n          i0.ɵɵtext(24);\n          i0.ɵɵelementEnd()();\n          i0.ɵɵelementStart(25, \"div\", 4)(26, \"span\", 5);\n          i0.ɵɵtext(27, \"Game ID\");\n          i0.ɵɵelementEnd();\n          i0.ɵɵelementStart(28, \"span\", 7);\n          i0.ɵɵtext(29);\n          i0.ɵɵelementEnd()()();\n          i0.ɵɵelementStart(30, \"section\", 8);\n          i0.ɵɵtemplate(31, AppComponent_div_31_Template, 3, 1, \"div\", 9);\n          i0.ɵɵelementEnd();\n          i0.ɵɵelementStart(32, \"section\", 10)(33, \"div\", 11)(34, \"h2\");\n          i0.ɵɵtext(35, \"Move History\");\n          i0.ɵɵelementEnd();\n          i0.ɵɵelementStart(36, \"ul\");\n          i0.ɵɵtemplate(37, AppComponent_li_37_Template, 2, 4, \"li\", 12)(38, AppComponent_li_38_Template, 2, 0, \"li\", 13);\n          i0.ɵɵelementEnd()();\n          i0.ɵɵelementStart(39, \"div\", 11)(40, \"h2\");\n          i0.ɵɵtext(41, \"Live Updates\");\n          i0.ɵɵelementEnd();\n          i0.ɵɵelementStart(42, \"p\");\n          i0.ɵɵtext(43);\n          i0.ɵɵelementEnd();\n          i0.ɵɵtemplate(44, AppComponent_div_44_Template, 2, 1, \"div\", 14);\n          i0.ɵɵelementEnd()()();\n        }\n        if (rf & 2) {\n          i0.ɵɵadvance(7);\n          i0.ɵɵproperty(\"disabled\", ctx.isSimulating);\n          i0.ɵɵadvance();\n          i0.ɵɵtextInterpolate1(\" \", ctx.isSimulating ? \"Simulating...\" : \"Start Simulation\", \" \");\n          i0.ɵɵadvance(6);\n          i0.ɵɵtextInterpolate(ctx.sessionStatus || \"-\");\n          i0.ɵɵadvance(5);\n          i0.ɵɵtextInterpolate(ctx.gameStatus || \"-\");\n          i0.ɵɵadvance(5);\n          i0.ɵɵtextInterpolate(ctx.sessionId || \"-\");\n          i0.ɵɵadvance(5);\n          i0.ɵɵtextInterpolate(ctx.gameId || \"-\");\n          i0.ɵɵadvance(2);\n          i0.ɵɵproperty(\"ngForOf\", ctx.board);\n          i0.ɵɵadvance(6);\n          i0.ɵɵproperty(\"ngForOf\", ctx.moves);\n          i0.ɵɵadvance();\n          i0.ɵɵproperty(\"ngIf\", ctx.moves.length === 0);\n          i0.ɵɵadvance(5);\n          i0.ɵɵtextInterpolate(ctx.lastMessage || \"Waiting for updates...\");\n          i0.ɵɵadvance();\n          i0.ɵɵproperty(\"ngIf\", ctx.errorMessage);\n        }\n      },\n      dependencies: [CommonModule, i2.NgForOf, i2.NgIf],\n      styles: [\".page[_ngcontent-%COMP%]{max-width:960px;margin:0 auto;padding:32px 24px 64px}.header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;gap:16px;margin-bottom:24px}h1[_ngcontent-%COMP%]{margin:0;font-size:28px}.primary[_ngcontent-%COMP%]{background:#2d6cdf;color:#fff;border:none;border-radius:8px;padding:12px 20px;font-size:14px;cursor:pointer}.primary[_ngcontent-%COMP%]:disabled{opacity:.6;cursor:not-allowed}.status[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fit,minmax(180px,1fr));gap:12px;margin-bottom:24px}.status-item[_ngcontent-%COMP%]{background:#fff;border-radius:10px;padding:12px 16px;box-shadow:0 2px 6px #0000000d}.label[_ngcontent-%COMP%]{display:block;font-size:12px;color:#7b8794;margin-bottom:4px}.value[_ngcontent-%COMP%]{font-size:14px;font-weight:600}.mono[_ngcontent-%COMP%]{font-family:SFMono-Regular,Menlo,monospace;font-size:12px}.board[_ngcontent-%COMP%]{background:#fff;border-radius:16px;padding:24px;display:flex;justify-content:center;margin-bottom:24px;box-shadow:0 2px 6px #0000000d}.cell-row[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(3,80px);gap:8px}.cell-item[_ngcontent-%COMP%]{width:80px;height:80px;background:#f2f4f7;border-radius:12px;display:flex;align-items:center;justify-content:center;font-size:32px;font-weight:600;color:#344563}.info[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fit,minmax(280px,1fr));gap:16px}.panel[_ngcontent-%COMP%]{background:#fff;border-radius:12px;padding:16px;box-shadow:0 2px 6px #0000000d}.panel[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin:0 0 12px;font-size:16px}.panel[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]{list-style:none;padding:0;margin:0}.panel[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]{padding:6px 0;font-size:14px;border-bottom:1px solid #f0f0f0}.panel[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]:last-child{border-bottom:none}.error[_ngcontent-%COMP%]{margin-top:12px;padding:10px 12px;border-radius:8px;background:#fdecea;color:#b42318;font-size:13px}\"]\n    });\n  }\n  return AppComponent;\n})();","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}